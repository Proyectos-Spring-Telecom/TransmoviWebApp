<div class="container-fluid px-3 px-md-4 py-3 dashboard-wrap">

    <section class="dvx-hero">
      <div class="dvx-hero__title">
        <h1>Panel Operativo</h1>
        <p>Bluevox · {{ ahora | date:'dd/MM/yyyy HH:mm' }}</p>
      </div>
      <div class="dvx-hero__status">
        <span class="dot"></span> Actualización en vivo
      </div>
    </section>

    <!-- GRID PRINCIPAL -->
    <section class="dvx-grid">
      <!-- KPIs fila 1 -->
      <article class="dvx-card kpi" *ngFor="let k of kpiTop">
        <header class="card-head"><i class="material-icons">{{k.icon}}</i><span>{{k.title}}</span></header>
        <div class="kpi-main">{{k.value}}</div>
        <div class="kpi-foot" [innerHTML]="k.foot"></div>
      </article>

      <!-- Tabla TOP RUTAS -->
      <article class="dvx-card span-8">
        <header class="card-head"><i class="material-icons">leaderboard</i><span>Top 5 rutas por ingreso</span></header>
        <div class="dvx-table">
          <table>
            <thead>
              <tr>
                <th>Ruta</th>
                <th class="right">Ingresos</th>
                <th class="right">Pasajeros</th>
                <th class="right">Ticket</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let r of topRutas">
                <td>{{ r.ruta }}</td>
                <td class="right">{{ r.monto | currency:'MXN':'symbol':'1.0-0' }}</td>
                <td class="right">{{ r.pasajeros | number }}</td>
                <td class="right">{{ r.ticket | currency:'MXN' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </article>

      <!-- DISPOSITIVOS CON ALERTAS -->
      <article class="dvx-card span-4">
        <header class="card-head"><i class="material-icons">warning_amber</i><span>Dispositivos con alertas</span></header>
        <ul class="dvx-alerts">
          <li *ngFor="let a of alertasDispositivos" [attr.data-sev]="a.severidad">
            <div>
              <div class="strong">{{ a.nombre }}</div>
              <div class="dim">{{ a.detalle }}</div>
            </div>
            <span class="pill" [ngClass]="a.severidad">{{ a.tag }}</span>
          </li>
        </ul>
      </article>

      <!-- GRÁFICAS -->
      <article class="dvx-card span-7">
        <header class="card-head"><i class="material-icons">bar_chart</i><span>Ingresos por hora (hoy)</span><em>Barras + ticket</em></header>
        <div class="dvx-plot">
          <dx-chart [dataSource]="ingresosHora" class="dx-chart-brand">
            <dxi-series type="bar" argumentField="hora" valueField="ingresos" name="Ingresos"></dxi-series>
            <dxi-series type="line" argumentField="hora" valueField="ticket" name="Ticket"></dxi-series>
            <dxo-legend [visible]="true" position="inside" horizontalAlignment="right" verticalAlignment="top"></dxo-legend>
            <dxo-tooltip [enabled]="true"></dxo-tooltip>
          </dx-chart>
        </div>
      </article>

      <article class="dvx-card span-5">
        <header class="card-head"><i class="material-icons">donut_small</i><span>Distribución de medios de pago</span><em>Hoy</em></header>
        <div class="dvx-plot">
          <dx-pie-chart [dataSource]="pagoDistrib" type="doughnut" class="dx-chart-brand">
            <dxi-series argumentField="metodo" valueField="valor"></dxi-series>
            <dxo-legend [visible]="true" horizontalAlignment="center" verticalAlignment="bottom"></dxo-legend>
            <dxo-tooltip [enabled]="true"></dxo-tooltip>
            <dxo-label [visible]="true" [format]="{ type:'percent', precision:0 }"></dxo-label>
          </dx-pie-chart>
        </div>
      </article>

      <article class="dvx-card span-7">
        <header class="card-head"><i class="material-icons">timeline</i><span>Curva de ascensos vs boletos</span><em>Brecha</em></header>
        <div class="dvx-plot">
          <dx-chart [dataSource]="ascensosVsBoletos" class="dx-chart-brand">
            <dxi-series type="line" argumentField="hora" valueField="ascensos" name="Ascensos"></dxi-series>
            <dxi-series type="line" argumentField="hora" valueField="boletos"  name="Validaciones"></dxi-series>
            <dxo-legend [visible]="true"></dxo-legend>
            <dxo-tooltip [enabled]="true"></dxo-tooltip>
          </dx-chart>
        </div>
      </article>

      <article class="dvx-card span-5">
        <header class="card-head"><i class="material-icons">schedule</i><span>Puntualidad de inicio de viaje</span><em>Δ minutos</em></header>
        <div class="dvx-plot">
          <dx-chart [dataSource]="histPuntualidad" class="dx-chart-brand">
            <dxi-series type="bar" argumentField="bucket" valueField="conteo" name="Viajes"></dxi-series>
            <dxo-legend [visible]="false"></dxo-legend>
            <dxo-tooltip [enabled]="true"></dxo-tooltip>
          </dx-chart>
        </div>
      </article>
    </section>
</div>